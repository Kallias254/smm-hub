FROM node:22-alpine

# Install system dependencies (FFmpeg is required for the creative engine)
RUN apk add --no-cache ffmpeg

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /home/node/app

# Copy entrypoint script and ensure it's executable
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# We don't COPY files here because they are mounted via volumes in docker-compose for dev
EXPOSE 3000

ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]
CMD ["pnpm", "dev"]